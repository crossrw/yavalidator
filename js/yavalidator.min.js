/**
 * @file YetAnotherValidator
 * @author Aleksey Lutovinin <crossrw1@gmail.com>
 * @version 1.0
 * @license MIT
 */
var yav_regex_number=/^-?\d+$/,yav_regex_float=/^-?[0-9]+([.][0-9]+)?$/,yav_regex_email=/^.+@[^\.].*\.[a-z]{2,}$/i,yav_regex_phone=/^(\+\d|\d)?[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/,yav_regex_url=/^(?:(?:http|https|ftp):\/\/)?(?:(?:[a-z][\w~%!&amp;',;=\-\.$\(\)\*\+]*):.*@)?(?:(?:[a-z0-9][\w\-]*[a-z0-9]*\.)*(?:(?:(?:(?:[a-z0-9][\w\-]*[a-z0-9]*)(?:\.[a-z0-9]+)?)|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))(?::[0-9]+)?))?(?:(?:(?:\/(?:[\w`~!$=;\-\+\.\^\(\)\|\{\}\[\]]|(?:%\d\d))+)*\/(?:[\w`~!$=;\-\+\.\^\(\)\|\{\}\[\]]|(?:%\d\d))*)(?:\?[^#]+)?(?:#[a-z0-9]\w*)?)?$/i,yav_regex_hostname=/^[a-zA-Z]([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,yav_regex_ip=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,yav_regex_kpp=/^[0-9]{4}[0-9A-Z]{2}[0-9]{3}$/,yav_regex_inn=/^((?:\d{10})|(?:\d{12}))$/,yav_regex_acc=/^\d{20}$/,yav_regex_snils=/^\d{11}$/,yav_regex_bik=/^\d{9}$/;class YAValidator{constructor(e,t,a,i){this.invalidClassName=t,this.options=Object.assign({},{disabled:!1,readonly:!1,hidden:!1,onedit:!1},a),this.changeDataCB=i||null,this.fixedData=null;var s=this;if(this.elementsList=document.getElementsByClassName(e),this.options.onedit&&t||this.changeDataCB)for(var n=0;n<this.elementsList.length;n++){var r=this.elementsList[n];r.addEventListener("change",(function(e){s._changeHandler(s,e)}),!1),r.addEventListener("input",(function(e){s._changeHandler(s,e)}),!1)}this.validate_classes={"yav-hostname":yav_regex_hostname,"yav-integer":yav_regex_number,"yav-number":yav_regex_float,"yav-float":yav_regex_float,"yav-email":yav_regex_email,"yav-phone":yav_regex_phone,"yav-url":yav_regex_url,"yav-ip":yav_regex_ip,"yav-inn":yav_regex_inn,"yav-kpp":yav_regex_kpp,"yav-bik":yav_regex_bik,"yav-acc":yav_regex_acc,"yav-snils":yav_regex_snils}}_compareData(e,t){if(!t)return!0;for(var a in e)if(a in t&&e[a]!=t[a])return!0;return!1}_changeHandler(e,t){if(e.invalidClassName){var a=t.target;e._validateElement(a)?a.classList.remove(e.invalidClassName):a.classList.add(e.invalidClassName)}if(e.changeDataCB){var i=e.validate(),s=e.getData(),n=e._compareData(s,e.fixedData);e.changeDataCB(n,i,s)}}validate(){var e,t=!0;this.invalidClassName&&this.invalidate();for(var a=0;a<this.elementsList.length;a++)if(e=this.elementsList[a],(this.options.disabled||!e.getAttribute("disabled"))&&(this.options.readonly||!e.getAttribute("readonly"))){if(!this.options.hidden)if("none"==window.getComputedStyle(e).display)continue;this._validateElement(e)||(this.invalidClassName&&e.classList.add(this.invalidClassName),t=!1)}return t}_validateElement(e){if("INPUT"!=e.tagName)return!0;if("number"==e.type&&e.validity&&!e.validity.valid)return!1;var t=e.value;if(e.hasAttribute("required")){if(!t)return!1}else if(!t)return!0;switch(e.type){case"text":var a=e.getAttribute("pattern");if(a)return new RegExp(a).test(t);var i=!0;for(var s in this.validate_classes)if(e.classList.contains(s)){if(this.validate_classes[s].test(t))switch(s){case"yav-inn":if(this._checkInn(t))return!0;break;case"yav-snils":if(this._checkSnils(t))return!0;break;default:return!0}i=!1}return i;case"url":return yav_regex_url.test(t);case"tel":return yav_regex_phone.test(t);case"email":return yav_regex_email.test(t);case"number":return!!yav_regex_float.test(t)&&(t=parseFloat(t),!(e.hasAttribute("min")&&t<e.getAttribute("min"))&&!(e.hasAttribute("max")&&t>e.getAttribute("max")));default:return!0}}invalidate(){if(this.invalidClassName)for(var e=0;e<this.elementsList.length;e++)this.elementsList[e].classList.remove(this.invalidClassName)}setData(e,t,a){if(e){for(var i,s=0;s<this.elementsList.length;s++)if("INPUT"==(i=this.elementsList[s]).tagName&&"radio"==i.type){var n=i.name;if(!n)continue;var r=document.getElementsByName(n);if(!r.length)continue;if(t&&0===n.indexOf(t)&&(n=n.substring(t.length)),!(n in e))continue;for(var l=0;l<r.length;l++)if(r[l].value==e[n]){r[l].checked=!0;break}}else{var d=i.id;if(!d)continue;t&&0===d.indexOf(t)&&(d=d.substring(t.length)),d in e&&("INPUT"==i.tagName&&"checkbox"==i.type?i.checked=!!e[d]:i.value=e[d])}if(a){var v=this.validate();this.changeDataCB&&this.changeDataCB(!1,v,this.fixedData)}else this.fixData()}}getData(e){for(var t,a={},i=0;i<this.elementsList.length;i++)if(t=this.elementsList[i],(this.options.disabled||!t.getAttribute("disabled"))&&(this.options.readonly||!t.getAttribute("readonly"))){if(!this.options.hidden)if("none"==window.getComputedStyle(t).display)continue;if("INPUT"==t.tagName&&"radio"==t.type){var s=t.name;if(!s)continue;var n=document.querySelector('input[name="'+s+'"]:checked').value;if(e&&0===s.indexOf(e)&&(s=s.substring(e.length)),s in a)continue;a[s]=n}else{var r=t.id;if(!r)continue;e&&0===r.indexOf(e)&&(r=r.substring(e.length)),a[r]=this._getValue(t)}}return a}fixData(){if(this.fixedData=this.getData(),this.options.onedit){var e=this.validate();this.changeDataCB&&this.changeDataCB(!1,e,this.fixedData)}}restoreData(){this.fixedData&&this.setData(this.fixedData,"",!0)}_getValue(e){if("INPUT"===e.tagName)switch(e.type){case"number":case"range":return parseFloat(e.value);case"checkbox":return e.checked;default:return e.value}return e.value}_checkInn(e){if(10===e.length)return Number(e[9])===e.split("").slice(0,-1).reduce(((e,t,a)=>[2,4,10,3,5,9,4,6,8][a]*Number(t)+e),0)%11%10;var t=e.split("").slice(0,-2).reduce(((e,t,a)=>[7,2,4,10,3,5,9,4,6,8][a]*Number(t)+e),0)%11%10,a=e.split("").slice(0,-1).reduce(((e,t,a)=>[3,7,2,4,10,3,5,9,4,6,8][a]*Number(t)+e),0)%11%10;return t===Number(e[10])&&a===Number(e[11])}_checkSnils(e){for(var t=0,a=0;a<9;a++)t+=parseInt(e[a],10)*(9-a);return t>=100&&t>101&&100===(t%=101)&&(t=0),t===parseInt(e.slice(-2),10)}}
